<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Test - Carmen.NET Docs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-status {
            padding: 12px;
            margin: 12px 0;
            border-radius: 4px;
            font-weight: 600;
        }
        .test-status.pending {
            background: #fff3cd;
            color: #856404;
        }
        .test-status.success {
            background: #d4edda;
            color: #155724;
        }
        .test-status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .mermaid {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin: 16px 0;
        }
        button {
            background: #1976D2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-right: 12px;
        }
        button:hover {
            background: #1565C0;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1><i class="fas fa-flask"></i> Mermaid Rendering Test</h1>

    <div class="test-section">
        <h2>Test 1: Direct Mermaid Diagram</h2>
        <div id="status1" class="test-status pending">⏳ Waiting for render...</div>
        <div class="mermaid">
graph TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Option 1]
    B -->|No| D[Option 2]
    C --> E[End]
    D --> E
        </div>
    </div>

    <div class="test-section">
        <h2>Test 2: Flowchart Diagram</h2>
        <div id="status2" class="test-status pending">⏳ Waiting for render...</div>
        <div class="mermaid">
flowchart LR
    A[User] --> B[API Gateway]
    B --> C[Auth Service]
    B --> D[Business Logic]
    D --> E[Database]
        </div>
    </div>

    <div class="test-section">
        <h2>Test 3: Sequence Diagram</h2>
        <div id="status3" class="test-status pending">⏳ Waiting for render...</div>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant API
    participant DB
    User->>API: Request
    API->>DB: Query
    DB-->>API: Data
    API-->>User: Response
        </div>
    </div>

    <div class="test-section">
        <h2>Test Controls</h2>
        <button onclick="runTests()"><i class="fas fa-play"></i> Run Tests</button>
        <button onclick="location.href='index.html'"><i class="fas fa-home"></i> Back to Docs</button>
    </div>

    <div class="test-section">
        <h2>Console Output</h2>
        <pre id="console-output">No tests run yet...</pre>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        const consoleOutput = document.getElementById('console-output');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '❌' : type === 'success' ? '✅' : 'ℹ️';
            consoleOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            console.log(message);
        }

        // Initialize Mermaid
        log('Initializing Mermaid...');
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
            logLevel: 'error'
        });
        log('Mermaid initialized', 'success');

        function runTests() {
            consoleOutput.textContent = '';
            log('Starting Mermaid rendering tests...');

            const mermaidElements = document.querySelectorAll('.mermaid');
            log(`Found ${mermaidElements.length} mermaid diagrams`);

            // Reset status
            document.querySelectorAll('.test-status').forEach(el => {
                el.className = 'test-status pending';
                el.textContent = '⏳ Rendering...';
            });

            // Add unique IDs
            mermaidElements.forEach((element, index) => {
                element.id = `mermaid-test-${Date.now()}-${index}`;
                log(`Assigned ID: ${element.id}`);
            });

            // Render
            setTimeout(() => {
                try {
                    log('Calling mermaid.init()...');
                    mermaid.init(undefined, '.mermaid');
                    log('Mermaid.init() completed', 'success');

                    // Check each diagram
                    setTimeout(() => {
                        mermaidElements.forEach((element, index) => {
                            const svg = element.querySelector('svg');
                            const statusEl = document.getElementById(`status${index + 1}`);

                            if (svg) {
                                statusEl.className = 'test-status success';
                                statusEl.innerHTML = `✅ Rendered successfully! SVG size: ${svg.getBBox().width.toFixed(0)}x${svg.getBBox().height.toFixed(0)}`;
                                log(`Test ${index + 1}: SUCCESS`, 'success');
                            } else {
                                statusEl.className = 'test-status error';
                                statusEl.textContent = '❌ Failed to render SVG';
                                log(`Test ${index + 1}: FAILED`, 'error');
                            }
                        });

                        log('All tests completed!', 'success');
                    }, 500);

                } catch (err) {
                    log(`Error: ${err.message}`, 'error');
                    document.querySelectorAll('.test-status').forEach(el => {
                        el.className = 'test-status error';
                        el.textContent = `❌ Error: ${err.message}`;
                    });
                }
            }, 100);
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            log('Page loaded, running tests in 1 second...');
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>
